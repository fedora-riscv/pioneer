From 20d5965adbb9d48858b5da131b312c4df15bf933 Mon Sep 17 00:00:00 2001
From: Peter <craven@gmx.net>
Date: Thu, 7 Feb 2019 11:25:57 +0100
Subject: [PATCH] Add ship name and class to intro screen.

---
 data/pigui/mainmenu.lua | 14 ++++++++++++++
 src/Intro.h             |  1 +
 src/LuaEngine.cpp       | 20 ++++++++++++++++++++
 3 files changed, 35 insertions(+)

diff --git a/data/pigui/mainmenu.lua b/data/pigui/mainmenu.lua
index 5041096346..0561d3ed55 100644
--- a/data/pigui/mainmenu.lua
+++ b/data/pigui/mainmenu.lua
@@ -168,6 +168,20 @@ local function showMainMenu()
 			ui.withFont("orbiteer",36 * (ui.screenHeight/1200),function() ui.text("Pioneer") end)
 		end)
 	end)
+	ui.setNextWindowPos(Vector(ui.screenWidth / 4.2,ui.screenHeight / 5.0 * 4),'Always')
+	ui.withStyleColors({["WindowBg"]=colors.transparent}, function()
+		ui.window("shipinfoWindow", {"NoTitleBar","NoResize","NoFocusOnAppearing","NoBringToFrontOnFocus","AlwaysAutoResize"}, function()
+			ui.withFont("orbiteer",30 * (ui.screenHeight/1200),function()
+				local mn = Engine.GetIntroCurrentModelName()
+				if mn then
+					local sd = ShipDef[mn]
+					if sd then
+						ui.text(sd.name .. " - " .. lui[sd.shipClass:upper()])
+					end
+				end
+			end)
+		end)
+	end)
 	local build_text = Engine.version
 	ui.withFont("orbiteer", 16 * (ui.screenHeight/1200),
 							function()
diff --git a/src/Intro.h b/src/Intro.h
index 641cac08d0..746b5b2562 100644
--- a/src/Intro.h
+++ b/src/Intro.h
@@ -14,6 +14,7 @@ class Intro : public Cutscene {
 	Intro(Graphics::Renderer *r, int width, int height);
 	~Intro();
 	virtual void Draw(float time);
+	SceneGraph::Model *getCurrentModel() const { return m_model; }
 
 private:
 	void Reset(float time);
diff --git a/src/LuaEngine.cpp b/src/LuaEngine.cpp
index 20fc8d59cc..bf52fb05e6 100644
--- a/src/LuaEngine.cpp
+++ b/src/LuaEngine.cpp
@@ -7,6 +7,7 @@
 #include "FloatComparison.h"
 #include "Game.h"
 #include "GameConfig.h"
+#include "Intro.h"
 #include "KeyBindings.h"
 #include "Lang.h"
 #include "LuaConstants.h"
@@ -695,6 +696,23 @@ static int l_engine_set_gpu_jobs_enabled(lua_State *l)
 	return 0;
 }
 
+static int l_engine_get_intro_current_model_name(lua_State *l)
+{
+	if (Pi::intro) {
+		SceneGraph::Model *m = Pi::intro->getCurrentModel();
+		if (m) {
+			LuaPush(l, m->GetName());
+			return 1;
+		} else {
+			lua_pushnil(l);
+			return 1;
+		}
+	} else {
+		lua_pushnil(l);
+		return 1;
+	}
+}
+
 /*
  * Method: ShipSpaceToScreenSpace
  *
@@ -1160,6 +1178,8 @@ void LuaEngine::Register()
 
 		{ "GetModel", l_engine_get_model },
 
+		{ "GetIntroCurrentModelName", l_engine_get_intro_current_model_name },
+
 		{ "GetSectorMapZoomLevel", l_engine_get_sector_map_zoom_level },
 		{ "SectorMapZoomIn", l_engine_sector_map_zoom_in },
 		{ "SectorMapZoomOut", l_engine_sector_map_zoom_out },
